---           
layout: post
title: MongoDB Covered Index
date: 2011-09-29 18:50:34 UTC
updated: 2011-09-29 18:50:34 UTC
comments: false
categories: mongodb
---

Covered index can greatly reduce your working set size, since it loads the sub document from the index only.<br /><br />Lets say we have the following documents:<br /><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><code>{ "_id" : "1", "prop1" : "a", "prop2" : "b", "prop3" : "c", "prop4" :&nbsp;"d", "prop5" : 1 }<br />{ "_id" : "2", "prop1" : "a", "prop2" : "b", "prop3" : "c", "prop4" :&nbsp;"d", "prop5" : 2 }</code>&nbsp;</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">when you create an index on prop1 and execute</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><code>db.coll.find({"prop1":"a"},{"prop2":1,"prop3":1})</code>&nbsp;</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">the entire document will be loaded. But if you have an index covering prop1,prop2 and prop3, you can benefit from the covered index.</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="font-family: arial, sans-serif;"><span class="Apple-style-span" style="font-size: 12px;">Here is another example:</span></span><br /><span class="Apple-style-span" style="font-family: arial, sans-serif;"><span class="Apple-style-span" style="font-size: 12px;"><br /></span></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">db.coll.ensureIndex({'prop1':1, 'prop2':1,'prop3':1,'prop4': 1,'prop5':&nbsp;1});</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">db.coll.find( {'prop1':'a'}, {'_id':0,'prop1':1, 'prop2':1,'prop3':&nbsp;</span><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">1}).sort({'prop5':1}).explain()&nbsp;</span><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">&nbsp;</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">check the index only at the result:</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">&nbsp; "cursor" : "BtreeCursor<br />prop1_1_prop2_1_prop3_1_prop4_1_prop5_1",<br />&nbsp; &nbsp; &nbsp; &nbsp; "nscanned" : 2,<br />&nbsp; &nbsp; &nbsp; &nbsp; "nscannedObjects" : 2,<br />&nbsp; &nbsp; &nbsp; &nbsp; "n" : 2,<br />&nbsp; &nbsp; &nbsp; &nbsp; "scanAndOrder" : true,<br />&nbsp; &nbsp; &nbsp; &nbsp; "millis" : 0,<br />&nbsp; &nbsp; &nbsp; &nbsp; "nYields" : 0,<br />&nbsp; &nbsp; &nbsp; &nbsp; "nChunkSkips" : 0,<br />&nbsp; &nbsp; &nbsp; &nbsp; "isMultiKey" : false,<br />&nbsp; &nbsp; &nbsp; &nbsp;<b> "indexOnly" : true,&nbsp;</b></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;">&nbsp; &nbsp; &nbsp; ......</span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="font-family: arial, sans-serif;"><span class="Apple-style-span" style="font-size: 12px;">Obviously when you have hundreds of properties this can make a huge difference.</span></span><br /><span class="Apple-style-span" style="font-family: arial, sans-serif;"><span class="Apple-style-span" style="font-size: 12px;"><br /></span></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span><br /><span class="Apple-style-span" style="background-color: white; font-family: arial, sans-serif; font-size: 12px;"><br /></span>